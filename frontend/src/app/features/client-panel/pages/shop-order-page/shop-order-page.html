<div class="orders-compact-container">
  <h1 class="page-title">Historial de Pedidos</h1>

  <div *ngIf="shopOrder$ | async as orders; else loadingTemplate">
    
    <div *ngIf="orders.length > 0; else emptyTemplate">
      <div *ngFor="let order of orders" class="order-mini-card">
        
        <div class="order-header">
          <div class="header-left">
            <span class="order-id">Pedido #{{ order.id }}</span>
            <span class="order-date">{{ order.created | date:'short' }}</span>
          </div>
          <div class="header-right">
            <button class="btn-repeat" (click)="repeatShopOrder(order.id)">
              <mat-icon>refresh</mat-icon> Repetir
            </button>
            <span class="status-badge">
              {{ order.shopOrderStatusName }}
            </span>
          </div>
        </div>

        <div class="order-body">
          <table class="items-table">
            <thead>
              <tr>
                <th>Producto</th>
                <th class="text-center">Cant.</th>
                <th class="text-right">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of order.items">
                <td>
                  <span class="product-name">{{ item.product.name }}</span>
                  <small class="product-meta">{{ item.product.measurementUnit }} {{ item.product.measurementName }}</small>
                </td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-right font-bold">{{ item.subtotal | currency:'EUR' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="order-gifts" *ngIf="order.pokeGift && order.pokeGift.length > 0">
          <p class="gifts-label">Regalos</p>
          <div class="sticker-album">
            <div *ngFor="let pokemon of order.pokeGift" class="sticker-item" [title]="pokemon.name">
              <div class="sticker-wrapper">
                <img [src]="pokemon.imageUrl" class="pokemon-img">
              </div>
            </div>
          </div>
        </div>

        <div class="order-footer">
          <span class="total-label">Total:</span>
          <span class="total-amount">{{ order.totalAmount | currency:'EUR' }}</span>
        </div>
      </div>
    </div>
  </div>

  <ng-template #emptyTemplate>
    <div class="empty-state-mini">
      <mat-icon>history_ambiguous</mat-icon>
      <p>No hay pedidos en tu historial.</p>
      <button class="btn-primary-mini" routerLink="/shop">Ir a la tienda</button>
    </div>
  </ng-template>

  <ng-template #loadingTemplate>
    <div class="loading-state-mini">
      <div class="spinner-mini"></div>
      <p>Cargando historial...</p>
    </div>
  </ng-template>
</div>